---
ID: "88b91424-ffd9-4ede-8e16-145ca5f536fe"
Parent: "d800c068-9717-49a0-961e-f913d7c0053c"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/OneWeb/OneWeb/OneWeb/OneWeb/Scripts/42-component-search"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/88B91424FFD94EDE8E16145CA5F536FE.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "88f86a42-557b-41f3-9c4c-1cecf10cadc1"
  Value: dmFyIG93U2VhcmNoID0gKGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgbG9hZG1vcmUgPSBmYWxzZTsNCiAgICB2YXIgY2xlYXJUZXh0ID0gZmFsc2U7DQogICAgdmFyIFBhZ2luYXRpb25UeXBlID0gew0KICAgICAgICBOb25lOiAwLA0KICAgICAgICBMYXp5TG9hZDogMSwNCiAgICAgICAgUGFnaW5hdGlvbjogMiwNCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gdHJpZ2dlck5vcm1hbFNlYXJjaChzZWFyY2hCb3hFbGVtKSB7DQogICAgICAgIHZhciBzZWFyY2hPYmplY3QgPSB7DQogICAgICAgICAgICBXcmFwcGVyOiBnZXRSZXN1bHRXcmFwcGVyKHNlYXJjaEJveEVsZW0pLA0KICAgICAgICAgICAgUGFnZVR5cGU6IFBhZ2luYXRpb25UeXBlLk5vbmUsDQogICAgICAgIH07DQogICAgICAgIGlmIChzZWFyY2hPYmplY3QuV3JhcHBlciAhPSB1bmRlZmluZWQgJiYgc2VhcmNoT2JqZWN0LldyYXBwZXIubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgc3RhcnRTZWFyY2goc2VhcmNoT2JqZWN0LCBmYWxzZSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB2YXIgYXV0b1N1Z2dlc3RDb250ZXh0ID0gZ2V0QXV0b1N1Z2dlc3RDb250ZXh0KHNlYXJjaEJveEVsZW0sIGZhbHNlKTsNCiAgICAgICAgICAgIGlmIChjbGVhclRleHQgPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGF1dG9TdWdnZXN0Q29udGV4dC5TZWFyY2hQYWdlICsgIj9rZXl3b3JkPSIgKyBhdXRvU3VnZ2VzdENvbnRleHQuS2V5d29yZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNsZWFyVGV4dCA9IGZhbHNlOw0KDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzc1Jlc2V0RmlsdGVycyhjb25maWd1cmF0aW9uSWQpIHsNCiAgICAgICAgJCgnW293LWNvbmZpZy1pZD0nICsgY29uZmlndXJhdGlvbklkICsgJ11baXMtZmlsdGVyXScpLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGZpbHRlckdyb3VwID0gJCh0aGlzKS5maW5kKCcuZmlsdGVyLWZhY2V0LXdyYXBwZXInKS5ub3QoIi5vdy10ZW1wbGF0ZSAuZmlsdGVyLWZhY2V0LXdyYXBwZXIiKS5wYXJlbnRzKCcub3ctc2VhcmNoLXRlbXBsYXRlJykubm90KCdbaXMtYWR2YW5jZWQtZmlsdGVyXScpOw0KICAgICAgICAgICAgaWYgKGZpbHRlckdyb3VwICE9IHVuZGVmaW5lZCAmJiBmaWx0ZXJHcm91cC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cignaXMtYWxwaGFiZXQtZmlsdGVyJykgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBhY3RpdmVGaWx0ZXIgPSAkKHRoaXMpLmZpbmQoJy5pc0FjdGl2ZScpLnJlbW92ZUNsYXNzKCdpc0FjdGl2ZScpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS5hdHRyKCdpcy1saW5rLWZpbHRlcicpICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlRmlsdGVyID0gJCh0aGlzKS5maW5kKCcuaXNBY3RpdmUnKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUZpbHRlci5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5pc0FjdGl2ZScpLnJlbW92ZUNsYXNzKCdpc0FjdGl2ZScpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkLm1hcChmaWx0ZXJHcm91cC5maW5kKCdpbnB1dDpjaGVja2VkJyksIGZ1bmN0aW9uIChmaWx0ZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoZmlsdGVyKS5wcm9wKCdjaGVja2VkJywgJycpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAkLm1hcChmaWx0ZXJHcm91cC5maW5kKCdhLmlzQWN0aXZlJyksIGZ1bmN0aW9uIChmaWx0ZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKGZpbHRlcikuYXR0cigndmFsdWUnKSAhPSB1bmRlZmluZWQgJiYgJChmaWx0ZXIpLmF0dHIoJ3ZhbHVlJykubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZmlsdGVyKS5yZW1vdmVDbGFzcygnaXNBY3RpdmUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgZmlsdGVyR3JvdXAgPSAkKHRoaXMpLmZpbmQoJy5maWx0ZXItZmFjZXQtd3JhcHBlcicpLm5vdCgiLm93LXRlbXBsYXRlIC5maWx0ZXItZmFjZXQtd3JhcHBlciIpLnBhcmVudHMoJy5vdy1zZWFyY2gtdGVtcGxhdGVbaXMtYWR2YW5jZWQtZmlsdGVyXScpDQogICAgICAgICAgICBpZiAoZmlsdGVyR3JvdXAgIT0gdW5kZWZpbmVkICYmIGZpbHRlckdyb3VwLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICB2YXIgcHJpbWFyeUZpbHRlck9iamVjdCA9IHsNCiAgICAgICAgICAgICAgICAgICAgS2V5OiBmaWx0ZXJHcm91cC5maW5kKCcuZmlsdGVyLWZhY2V0LWhlYWQnKS5hdHRyKCdvdy1rZXknKSwNCiAgICAgICAgICAgICAgICAgICAgVmFsdWVzOiBbXQ0KICAgICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgICAkLm1hcChmaWx0ZXJHcm91cC5maW5kKCdpbnB1dDpjaGVja2VkJykubm90KCcuc3ViLWl0ZW0nKSwgZnVuY3Rpb24gKGZpbHRlcikgew0KICAgICAgICAgICAgICAgICAgICAkKGZpbHRlcikucHJvcCgnY2hlY2tlZCcsICcnKTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICQubWFwKGZpbHRlckdyb3VwLmZpbmQoJ2lucHV0LnN1Yi1pdGVtOmNoZWNrZWQnKSwgZnVuY3Rpb24gKGZpbHRlcikgew0KICAgICAgICAgICAgICAgICAgICAkKGZpbHRlcikucHJvcCgnY2hlY2tlZCcsICcnKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2xlYXJBbGwoKSB7DQogICAgICAgIG93Q29tbW9uLnJlbW92ZVVybFBhcmFtKCdmaWx0ZXJzJyk7DQogICAgICAgIHZhciBwYXJlbnREaXYgPSAkKCcuY2xlYXJBbGwtZmlsdGVyJykucGFyZW50cygnLmNvbXBvbmVudC1jb250ZW50JykuZmluZCgnW293LWNvbmZpZy1pZF0nKVswXTsNCiAgICAgICAgc3NSZXNldEZpbHRlcnMoJChwYXJlbnREaXYpLmF0dHIoJ293LWNvbmZpZy1pZCcpKTsNCiAgICAgICAgdmFyIHNlYXJjaE9iamVjdCA9IHsNCiAgICAgICAgICAgIFdyYXBwZXI6IGdldFJlc3VsdFdyYXBwZXIocGFyZW50RGl2KSwNCiAgICAgICAgICAgIFBhZ2VUeXBlOiBQYWdpbmF0aW9uVHlwZS5Ob25lLA0KICAgICAgICB9Ow0KICAgICAgICBpZiAoc2VhcmNoT2JqZWN0LldyYXBwZXIgIT0gdW5kZWZpbmVkICYmIHNlYXJjaE9iamVjdC5XcmFwcGVyLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHN0YXJ0U2VhcmNoKHNlYXJjaE9iamVjdCwgZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJpZ2dlckF1dG9TdWdnZXN0U2VhcmNoKGlucHV0RWxlbSwgc2VhcmNoQm94KSB7DQogICAgICAgIHZhciBzZWFyY2hPYmplY3QgPSB7DQogICAgICAgICAgICBQYWdlVHlwZTogUGFnaW5hdGlvblR5cGUuTm9uZSwNCiAgICAgICAgICAgIEVuZHBvaW50OiAnL29uZXdlYi9zZWFyY2gvZ2V0YXV0b3N1Z2dlc3RyZXN1bHRzJywNCiAgICAgICAgICAgIEtleXdvcmQ6IGlucHV0RWxlbS52YWwoKSwNCiAgICAgICAgICAgIFNvdXJjZUlkOiAkKHNlYXJjaEJveCkuYXR0cignb3ctYXMtY29uZmlnLWlkJyksDQogICAgICAgICAgICBDb250YWluZXI6ICQoc2VhcmNoQm94KS5maW5kKCcub3ctY29udGFpbmVyJyksDQogICAgICAgICAgICBMYW5ndWFnZTogJChzZWFyY2hCb3gpLmF0dHIoJ293LWxhbmd1YWdlJyksDQogICAgICAgICAgICBQYWdlVHlwZTogUGFnaW5hdGlvblR5cGUuTm9uZQ0KICAgICAgICB9DQogICAgICAgIHN0YXJ0U2VhcmNoKHNlYXJjaE9iamVjdCwgdHJ1ZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0UGxhY2Vob2xkZXJUZXh0KGVsZW0sIHNlYXJjaEJveCkgew0KICAgICAgICAkKGVsZW0pLmF0dHIoJ3BsYWNlaG9sZGVyLWJhaycsICQoZWxlbSkuYXR0cigncGxhY2Vob2xkZXInKSk7DQogICAgICAgICQoZWxlbSkuYXR0cigncGxhY2Vob2xkZXInLCBzZWFyY2hCb3guYXR0cignb3ctZW1wdHktdGV4dC1tZXNzYWdlJykpOw0KICAgICAgICAkKGVsZW0pLmFkZENsYXNzKCdlbXB0eS1tZXNzYWdlJyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcmVzZXRQbGFjZWhvbGRlclRleHQoZWxlbSkgew0KICAgICAgICAkKGVsZW0pLnJlbW92ZUNsYXNzKCdlbXB0eS1tZXNzYWdlJyk7DQogICAgICAgICQoZWxlbSkuYXR0cigncGxhY2Vob2xkZXInLCAkKGVsZW0pLmF0dHIoJ3BsYWNlaG9sZGVyLWJhaycpKTsNCiAgICB9DQoNCiAgICB2YXIgYmluZE9uZVRpbWVUcmlnZ2VycyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5vdy1zZWFyY2gtYm94IC52aWV3LWFsbCcsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICB2YXIgYXV0b1N1Z2dlc3RDb250ZXh0ID0gZ2V0QXV0b1N1Z2dlc3RDb250ZXh0KCQodGhpcyksIHRydWUpOw0KICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBhdXRvU3VnZ2VzdENvbnRleHQuU2VhcmNoUGFnZSArICI/a2V5d29yZD0iICsgYXV0b1N1Z2dlc3RDb250ZXh0LktleXdvcmQgKyAiJmZpbHRlcnM9IiArIGF1dG9TdWdnZXN0Q29udGV4dC5Hcm91cElkICsgIjoiICsgYXV0b1N1Z2dlc3RDb250ZXh0LklkOw0KICAgICAgICB9KTsNCg0KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgaWYgKCEkKGUudGFyZ2V0KS5oYXNDbGFzcygnc2VhcmNoLWJveC1pbnB1dCcpKSB7DQogICAgICAgICAgICAgICAgJCgnLm93LXNlYXJjaC1ib3gnKS5maW5kKCcub3ctY29udGFpbmVyJykuaHRtbCgnJyk7DQogICAgICAgICAgICAgICAgJCgnLm93LXNlYXJjaC1ib3gnKS5maW5kKCcucG9wdWxhci1rZXl3b3JkcycpLmFkZENsYXNzKCdkLW5vbmUnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgICQoZG9jdW1lbnQpLm9uKCdibHVyJywgJy5vdy1zZWFyY2gtYm94W293LWNvbmZpZy1pZF0gaW5wdXQnLCBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgIHJlc2V0UGxhY2Vob2xkZXJUZXh0KCQodGhpcykpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLm93LXNlYXJjaC1ib3hbb3ctY29uZmlnLWlkXSBpbnB1dCcsIGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgdmFyIHNlYXJjaEJveCA9ICQodGhpcykucGFyZW50cygnLm93LXNlYXJjaC1ib3gnKTsNCiAgICAgICAgICAgICQodGhpcykucGFyZW50cygnLm93LXNlYXJjaC1ib3gnKS5maW5kKCcub3ctY29udGFpbmVyJykuaHRtbCgnJyk7DQogICAgICAgICAgICB2YXIgYXV0b1N1Z2dlc3RUcmlnZ2VyID0gcGFyc2VJbnQoJChzZWFyY2hCb3gpLmF0dHIoJ293LWFzLWNvdW50JykpOw0KICAgICAgICAgICAgaWYgKGF1dG9TdWdnZXN0VHJpZ2dlciA9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBhdXRvU3VnZ2VzdFRyaWdnZXIgPSAzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCQodGhpcykudmFsKCkubGVuZ3RoID49IGF1dG9TdWdnZXN0VHJpZ2dlcikgew0KICAgICAgICAgICAgICAgIHRyaWdnZXJBdXRvU3VnZ2VzdFNlYXJjaCgkKHRoaXMpLCBzZWFyY2hCb3gpOw0KICAgICAgICAgICAgICAgIHNlYXJjaEJveC5maW5kKCcucG9wdWxhci1rZXl3b3JkcycpLmFkZENsYXNzKCdkLW5vbmUnKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgc2VhcmNoQm94LmZpbmQoJy5wb3B1bGFyLWtleXdvcmRzJykucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KDQogICAgICAgIC8vbG9hZCBtb3JlDQogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljayBrZXl1cCcsICcub3ctbG9hZC1tb3JlJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgbG9hZG1vcmUgPSB0cnVlOw0KICAgICAgICAgICAgdmFyIHNlYXJjaE9iamVjdCA9IHsNCiAgICAgICAgICAgICAgICBXcmFwcGVyOiBnZXRSZXN1bHRXcmFwcGVyKHRoaXMpLA0KICAgICAgICAgICAgICAgIFBhZ2VUeXBlOiBQYWdpbmF0aW9uVHlwZS5MYXp5TG9hZA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHN0YXJ0U2VhcmNoKHNlYXJjaE9iamVjdCwgZmFsc2UpOw0KICAgICAgICAgICAgbG9hZG1vcmUgPSBmYWxzZTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5vdy1zZWFyY2gtYm94W293LWNvbmZpZy1pZF0gLmljb24tc2VhcmNoJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmVzZXRQbGFjZWhvbGRlclRleHQoJCh0aGlzKSkNCiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2VtcHR5LW1lc3NhZ2UnKTsNCiAgICAgICAgICAgIHZhciBzZWFyY2hCb3ggPSAkKHRoaXMpLnBhcmVudHMoJy5vdy1zZWFyY2gtYm94JykuZmluZCgnaW5wdXQnKTsNCiAgICAgICAgICAgIGlmIChzZWFyY2hCb3gudmFsKCkubGVuZ3RoID4gMCB8fCAkKHRoaXMpLnBhcmVudHMoJy5vdy1zZWFyY2gtYm94JykuYXR0cignb3ctcmVzdWx0cy1ieS1kZWZhdWx0JykgPT0gJ1RydWUnKSB7DQogICAgICAgICAgICAgICAgdHJpZ2dlck5vcm1hbFNlYXJjaChzZWFyY2hCb3gpOw0KICAgICAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLnZhbCgpLmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgICAgICAgc2V0UGxhY2Vob2xkZXJUZXh0KHNlYXJjaEJveCwgJCh0aGlzKS5wYXJlbnRzKCcub3ctc2VhcmNoLWJveCcpKTsNCiAgICAgICAgICAgICAgICB0cmlnZ2VyTm9ybWFsU2VhcmNoKHNlYXJjaEJveCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgICQoZG9jdW1lbnQpLm9uKCdrZXl1cCcsICcub3ctc2VhcmNoLWJveFtvdy1jb25maWctaWRdIGlucHV0JywgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoIShldmVudC5rZXlDb2RlID09PSAzOCB8fCBldmVudC5rZXlDb2RlID09PSA0MCkpIHsNCiAgICAgICAgICAgICAgICByZXNldFBsYWNlaG9sZGVyVGV4dCgkKHRoaXMpKQ0KICAgICAgICAgICAgICAgIHZhciBzZWFyY2hCb3ggPSAkKHRoaXMpLnBhcmVudHMoJy5vdy1zZWFyY2gtYm94Jyk7DQogICAgICAgICAgICAgICAgJChzZWFyY2hCb3gpLmZpbmQoJy5vdy1jb250YWluZXInKS5odG1sKCcnKTsNCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykudmFsKCkubGVuZ3RoID4gMCB8fCBzZWFyY2hCb3guYXR0cignb3ctcmVzdWx0cy1ieS1kZWZhdWx0JykgPT0gJ1RydWUnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyTm9ybWFsU2VhcmNoKCQodGhpcykpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCQodGhpcykudmFsKCkubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNldFBsYWNlaG9sZGVyVGV4dCgkKHRoaXMpLCBzZWFyY2hCb3gpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoJChzZWFyY2hCb3gpLmF0dHIoJ293LWFzLWNvbmZpZy1pZCcpICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF1dG9TdWdnZXN0VHJpZ2dlciA9IHBhcnNlSW50KCQoc2VhcmNoQm94KS5hdHRyKCdvdy1hcy1jb3VudCcpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRvU3VnZ2VzdFRyaWdnZXIgPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1N1Z2dlc3RUcmlnZ2VyID0gMzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLnZhbCgpLmxlbmd0aCA+PSBhdXRvU3VnZ2VzdFRyaWdnZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyQXV0b1N1Z2dlc3RTZWFyY2goJCh0aGlzKSwgc2VhcmNoQm94KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLnZhbCgpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudHMoJy5vdy1zZWFyY2gtYm94JykuZmluZCgnLmNsZWFyLXRleHQnKS5hZGRDbGFzcygnZC1ibG9jaycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykudmFsKCkubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudHMoJy5vdy1zZWFyY2gtYm94JykuZmluZCgnLmNsZWFyLXRleHQnKS5yZW1vdmVDbGFzcygnZC1ibG9jaycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZmlsdGVyLWZhY2V0LXdyYXBwZXIgLnVuY2hlY2stYWxsJywgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICB2YXIgcGFyZW50Q29udGFpbmVyID0gJCh0aGlzKS5wYXJlbnRzKCdbb3ctY29uZmlnLWlkXScpOw0KICAgICAgICAgICAgdmFyIGNoZWNrZWRCb3hlcyA9ICQocGFyZW50Q29udGFpbmVyKS5maW5kKCcuZmlsdGVyLWl0ZW0gaW5wdXQ6Y2hlY2tlZCcpOw0KICAgICAgICAgICAgaWYgKGNoZWNrZWRCb3hlcy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkKHBhcmVudENvbnRhaW5lcikuZmluZCgnLmZpbHRlci1pdGVtIGlucHV0JykucHJvcCgnY2hlY2tlZCcsICcnKTsNCiAgICAgICAgICAgIGlmICgkKHRoaXMpLnBhcmVudHMoJy50YWItd3JhcHBlcicpICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50cygnLnRhYi13cmFwcGVyJykuZmluZCgnYScpLnJlbW92ZUNsYXNzKCdpc0FjdGl2ZScpOw0KICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2lzQWN0aXZlJyk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICQocGFyZW50Q29udGFpbmVyKS5maW5kKCcuaXNBY3RpdmUnKS5yZW1vdmVDbGFzcygnaXNBY3RpdmUnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBzZWFyY2hPYmplY3QgPSB7DQogICAgICAgICAgICAgICAgV3JhcHBlcjogZ2V0UmVzdWx0V3JhcHBlcih0aGlzKSwNCiAgICAgICAgICAgICAgICBQYWdlVHlwZTogUGFnaW5hdGlvblR5cGUuTm9uZQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3RhcnRTZWFyY2goc2VhcmNoT2JqZWN0LCBmYWxzZSk7DQogICAgICAgIH0pOw0KDQogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZmlsdGVyLWZhY2V0LXdyYXBwZXIgLmZpbHRlci1pdGVtIGlucHV0LCAuZmlsdGVyLWZhY2V0LXdyYXBwZXIgLmFscGhhYmV0aWMtZmFjZXQgYSwgLmZpbHRlci1mYWNldC13cmFwcGVyIC5maWx0ZXItaXRlbSBhLCAudGFiLXdyYXBwZXIgYScsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICBpZiAoJCh0aGlzKS5wYXJlbnRzKCdhbHBoYWJldGljLWZhY2V0JykgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSB7DQogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnaXNBY3RpdmUnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkKHRoaXMpLnBhcmVudHMoJy50YWItd3JhcHBlcicpICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50cygnLnRhYi13cmFwcGVyJykuZmluZCgnYScpLnJlbW92ZUNsYXNzKCdpc0FjdGl2ZScpOw0KICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2lzQWN0aXZlJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBzZWFyY2hPYmplY3QgPSB7DQogICAgICAgICAgICAgICAgV3JhcHBlcjogZ2V0UmVzdWx0V3JhcHBlcih0aGlzKSwNCiAgICAgICAgICAgICAgICBQYWdlVHlwZTogUGFnaW5hdGlvblR5cGUuTm9uZQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3RhcnRTZWFyY2goc2VhcmNoT2JqZWN0LCBmYWxzZSk7DQogICAgICAgIH0pOw0KDQogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZmlsdGVyLXNlYXJjaC13cmFwcGVyIGEuZmEtdGltZXMtY2lyY2xlJywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICB2YXIgc2VhcmNoT2JqZWN0ID0gew0KICAgICAgICAgICAgICAgIFdyYXBwZXI6IGdldFJlc3VsdFdyYXBwZXIoJCh0aGlzKSksDQogICAgICAgICAgICAgICAgUGFnZVR5cGU6IFBhZ2luYXRpb25UeXBlLk5vbmUsDQogICAgICAgICAgICB9DQogICAgICAgICAgICAkKHRoaXMpLnBhcmVudHMoJ2xhYmVsJykucmVtb3ZlKCk7DQogICAgICAgICAgICBzdGFydFNlYXJjaChzZWFyY2hPYmplY3QsIGZhbHNlKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgZnVuY3Rpb24gY2FsbEV2ZW50KGtleSkgew0KICAgICAgICAgICAgJChrZXkpLnBhcmVudHMoJy5vdy1zZWFyY2gtYm94JykuZmluZCgnaW5wdXQnKS52YWwoJycpOw0KICAgICAgICAgICAgJChrZXkpLnBhcmVudHMoJy5vdy1zZWFyY2gtYm94JykuZmluZCgnaW5wdXQnKS5mb2N1cygpOw0KICAgICAgICAgICAgJChrZXkpLnBhcmVudHMoJy5vdy1zZWFyY2gtYm94JykuZmluZCgnLmdsb2JhbC1zZWFyY2gnKS5hZGRDbGFzcygnZm9jdXNJbicpOw0KICAgICAgICAgICAgJChrZXkpLnJlbW92ZUNsYXNzKCdkLWJsb2NrJyk7DQogICAgICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPiA5OTIpIHsNCiAgICAgICAgICAgICAgICB2YXIgZWxlV2lkdGggPSAkKGtleSkucGFyZW50cygnLm93LXNlYXJjaC1ib3gnKS5pbm5lcldpZHRoKCk7DQogICAgICAgICAgICAgICAgdmFyIGV4dGVuZGVkV2l0aCA9ICQoa2V5KS5wYXJlbnRzKCcubW9iaWxlLW1lbnUnKS5uZXh0KCkud2lkdGgoKTsNCiAgICAgICAgICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPiAxMjAwKSB7DQogICAgICAgICAgICAgICAgICAgICQoa2V5KS5wYXJlbnRzKCcuZ2xvYmFsLXNlYXJjaCcpLndpZHRoKGVsZVdpZHRoICsgZXh0ZW5kZWRXaXRoICsgNTApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJChrZXkpLnBhcmVudHMoJy5nbG9iYWwtc2VhcmNoJykud2lkdGgoZWxlV2lkdGggKyBleHRlbmRlZFdpdGggKyAzMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jbGVhci10ZXh0JywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgIGNsZWFyVGV4dCA9IHRydWU7DQogICAgICAgICAgICBjYWxsRXZlbnQodGhpcykNCg0KICAgICAgICB9KTsNCg0KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmNsZWFyQWxsLWZpbHRlcicsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICBjbGVhckFsbCgpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnN1Z2dlc3Rpb24tbGFiZWwsIC50YXhvbm9teScsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnYXR0YWNoZWQnKSkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGlmICgkKCcuZmlsdGVyLXNlYXJjaC13cmFwcGVyJykuZmluZCgnbGFiZWxbdGFnLWlkPScgKyAkKHRoaXMpLmF0dHIoJ3RhZy1pZCcpICsgJ10nKS5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgICQoJy5maWx0ZXItc2VhcmNoLXdyYXBwZXInKS5hcHBlbmQoJzxsYWJlbCBjbGFzcz0ic3VnZ2VzdGlvbi1sYWJlbCB0YWciIHRhZy1pZD0nICsgJCh0aGlzKS5hdHRyKCd0YWctaWQnKSArICc+JyArICQodGhpcykuaHRtbCgpICsgJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImZhciBmYS10aW1lcy1jaXJjbGUiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2E+PC9sYWJlbD4nKTsNCiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoT2JqZWN0ID0gew0KICAgICAgICAgICAgICAgICAgICBXcmFwcGVyOiBnZXRSZXN1bHRXcmFwcGVyKHRoaXMpLA0KICAgICAgICAgICAgICAgICAgICBQYWdlVHlwZTogUGFnaW5hdGlvblR5cGUuTm9uZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzdGFydFNlYXJjaChzZWFyY2hPYmplY3QsIGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgY29uc3QgdHJpZ2dlclBhZ2luYXRpb24gPSBmdW5jdGlvbiAoc2VhcmNoV3JhcHBlcikgew0KICAgICAgICBsb2FkbW9yZSA9IHRydWU7DQogICAgICAgIHZhciBzZWFyY2hPYmplY3QgPSB7DQogICAgICAgICAgICBXcmFwcGVyOiBnZXRSZXN1bHRXcmFwcGVyKHNlYXJjaFdyYXBwZXIpLA0KICAgICAgICAgICAgUGFnZVR5cGU6IFBhZ2luYXRpb25UeXBlLlBhZ2luYXRpb24sDQogICAgICAgIH07DQogICAgICAgIHN0YXJ0U2VhcmNoKHNlYXJjaE9iamVjdCwgZmFsc2UpOw0KICAgICAgICBsb2FkbW9yZSA9IGZhbHNlOw0KICAgIH0NCg0KICAgIGNvbnN0IHJlbmRlclJlc3VsdHMgPSBmdW5jdGlvbiAoaW5wdXRPYmopIHsNCiAgICAgICAgaWYgKGlucHV0T2JqICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgJChpbnB1dE9iai5XcmFwcGVyKS5hdHRyKCdvdy1wYXJhbWV0ZXJzJywgSlNPTi5zdHJpbmdpZnkoaW5wdXRPYmouRGF0YS5QYXJhbWV0ZXJzKSk7DQogICAgICAgICAgICB2YXIgY29uZmlnSWQgPSAkKGlucHV0T2JqLldyYXBwZXIpLmF0dHIoJ293LWNvbmZpZy1pZCcpOw0KICAgICAgICAgICAgJCgnLm93LXNlYXJjaC1ib3hbb3ctY29uZmlnLWlkPScgKyBjb25maWdJZCArICddIGlucHV0Jykubm90KCcuZ2xvYmFsLWhlYWRlciBpbnB1dCcpLnZhbChpbnB1dE9iai5LZXl3b3JkKTsNCiAgICAgICAgICAgIHZhciBzZWFyY2hDb250ZXh0ID0gZ2V0Q29udGV4dChpbnB1dE9iai5XcmFwcGVyLCBQYWdpbmF0aW9uVHlwZS5Ob25lLCB0cnVlKTsNCiAgICAgICAgICAgIHZhciByckFwcGVuZFVybFBhcmFtZXRlcnMgPSBmdW5jdGlvbiAoc2VhcmNoT2JqKSB7DQogICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsNCiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTChjdXJyZW50VXJsKTsNCiAgICAgICAgICAgICAgICBpZiAoc2VhcmNoT2JqLktleXdvcmQgIT0gdW5kZWZpbmVkICYmIHNlYXJjaE9iai5LZXl3b3JkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoImtleXdvcmQiLCBlbmNvZGVVUklDb21wb25lbnQoc2VhcmNoT2JqLktleXdvcmQpKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLmRlbGV0ZSgia2V5d29yZCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoc2VhcmNoT2JqLkZpbHRlcnMgIT0gdW5kZWZpbmVkICYmIHNlYXJjaE9iai5GaWx0ZXJzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbHRlckxpc3QgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoT2JqLkZpbHRlcnMuZm9yRWFjaChmaWx0ZXIgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyTGlzdC5wdXNoKGZpbHRlci5LZXkgKyAiOiIgKyBmaWx0ZXIuVmFsdWVzLmpvaW4oJ3wnKSkNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoImZpbHRlcnMiLCBmaWx0ZXJMaXN0LmpvaW4oJzsnKSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5kZWxldGUoImZpbHRlcnMiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKCdzZWFyY2gnLCBzZWFyY2hPYmouS2V5d29yZCwgZGVjb2RlVVJJQ29tcG9uZW50KHVybC5ocmVmKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcnJSZW5kZXJGaWx0ZXJzID0gZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgICAgICAgICB2YXIgYWxsRmFjZXRzID0gZGF0YS5GYWNldHM7DQogICAgICAgICAgICAgICAgdmFyIGNvbmZpZ0lkID0gIGRhdGEuUGFyYW1ldGVycy5DdXJyZW50SXRlbUlkOw0KICAgICAgICAgICAgICAgIGRhdGEuRmFjZXRzLmZvckVhY2goZmFjZXQgPT4gew0KICAgICAgICAgICAgICAgICAgICB2YXIgZmFjZXRFbGVtID0gJCgnW293LWNvbmZpZy1pZD0nK2NvbmZpZ0lkKyddW293LXNvdXJjZS1pZD0nICsgZmFjZXQuSWRlbnRpZmllciArICddJyk7DQogICAgICAgICAgICAgICAgICAgIGlmIChmYWNldEVsZW0gIT0gdW5kZWZpbmVkICYmIGZhY2V0RWxlbS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFjZXRFbGVtLmF0dHIoJ2lzLWFscGhhYmV0LWZpbHRlcicpICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbGxFbGVtcyA9IGZhY2V0RWxlbS5maW5kKCcuYWxwaGFiZXRpYy1mYWNldCBhJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsRWxlbXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ3RhYkluZGV4JywgJy0xJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWNldC5WYWx1ZXMuZm9yRWFjaChmYWNldFZhbHVlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhY2V0VmFsdWVFbGVtID0gZmFjZXRFbGVtLmZpbmQoJy5hbHBoYWJldGljLWZhY2V0IGFbdmFsdWU9IicgKyBmYWNldFZhbHVlLk5hbWUudG9VcHBlckNhc2UoKS5zcGxpdCgnJylbMF0gKyAnIl0nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhY2V0VmFsdWVFbGVtICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjZXRWYWx1ZUVsZW0ucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWNldFZhbHVlRWxlbS5hdHRyKCd0YWJJbmRleCcsICcwJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhY2V0RWxlbS5hdHRyKCdpcy1zdGF0aWMtZmlsdGVyJykgPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaGFuZGxpbmcgY2FzZSBvZiBhZHZhbmNlZCBmaWx0ZXJzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gJChmYWNldEVsZW0pLmF0dHIoJ2lzLWFkdmFuY2VkLWZpbHRlcicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGF0dHIgIT09ICd1bmRlZmluZWQnICYmIGF0dHIgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAkKGZhY2V0RWxlbSkuYXR0cignb3ctbWFwcGluZy1hcGknKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3dDb21tb24uaXNWYWxpZEpzb24ocmVzcG9uc2UpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByaW1hcnlGYWNldCA9IGZhY2V0RWxlbS5hdHRyKCdvdy1wcmltYXJ5LWZhY2V0Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlY29uZGFyeUZhY2V0ID0gZmFjZXRFbGVtLmF0dHIoJ293LXNlY29uZGFyeS1mYWNldCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IHt9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLlZhbHVlcyA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLlByaW1hcnlGYWNldCA9IGFsbEZhY2V0cy5maW5kKChvKSA9PiB7IHJldHVybiBvWyJLZXkiXSA9PT0gcHJpbWFyeUZhY2V0IH0pOzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5TZWNvbmRhcnlGYWNldCA9IGFsbEZhY2V0cy5maW5kKChvKSA9PiB7IHJldHVybiBvWyJLZXkiXSA9PT0gc2Vjb25kYXJ5RmFjZXQgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gR2V0U2Vjb25kYXJ5RmFjZXRzRnJvbU1hcHBpbmcobWFwcGluZykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmlhYmxlTWFwcGluZ3MgPSBtYXBwaW5nLlNlY29uZGFyeUZpbHRlci5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIChpdGVtLlRpdGxlKTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbC5TZWNvbmRhcnlGYWNldC5WYWx1ZXMuZmlsdGVyKHggPT4gdmlhYmxlTWFwcGluZ3MuaW5kZXhPZih4Lk5hbWUpICE9IC0xKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzcG9uc2UuRGF0YSwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgY3VycmVudEZhY2V0ID0gZmFjZXRFbGVtLmZpbmQoIiMiICsgdmFsdWUuUHJpbWFyeUZpbHRlci5UaXRsZS5yZXBsYWNlKG5ldyBSZWdFeHAoIiAiLCAiZyIpLCAnXFwgJykpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWNldE1vZGVsID0ge30NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhY2V0VmFsdWVzID0gbW9kZWwuUHJpbWFyeUZhY2V0LlZhbHVlcy5maWx0ZXIoeCA9PiB4Lk5hbWUgPT0gdmFsdWUuUHJpbWFyeUZpbHRlci5UaXRsZSlbMF07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWNldFZhbHVlcyAhPSB1bmRlZmluZWQgJiYgZmFjZXRWYWx1ZXMuQ291bnQgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWNldE1vZGVsLlByaW1hcnkgPSBmYWNldFZhbHVlcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjZXRNb2RlbC5TZWNvbmRhcnkgPSBHZXRTZWNvbmRhcnlGYWNldHNGcm9tTWFwcGluZyh2YWx1ZSwgbW9kZWwuU2Vjb25kYXJ5RmFjZXQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuVmFsdWVzLnB1c2goZmFjZXRNb2RlbCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoYk9iamVjdCA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU291cmNlSWQ6IGZhY2V0RWxlbS5hdHRyKCdvdy1zb3VyY2UtaWQnKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3dIYW5kbGViYXIucG9wdWxhdGUoaGJPYmplY3QsIG1vZGVsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coeGhyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoYk9iamVjdCA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTb3VyY2VJZDogZmFjZXRFbGVtLmF0dHIoJ293LXNvdXJjZS1pZCcpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjZXQuVmFsdWVzID0gZmFjZXQuVmFsdWVzLnNvcnQoKGEsIGIpID0+IChhLk5hbWUgPiBiLk5hbWUpID8gMSA6ICgoYi5OYW1lID4gYS5OYW1lKSA/IC0xIDogMCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvd0hhbmRsZWJhci5wb3B1bGF0ZShoYk9iamVjdCwgZmFjZXQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJzID0gb3dDb21tb24uZ2V0RmlsdGVycygpOw0KICAgICAgICAgICAgICAgIGZpbHRlcnMuZm9yRWFjaChmaWx0ZXIgPT4gew0KICAgICAgICAgICAgICAgICAgICB2YXIgZmlsdGVyRWxlbSA9ICQoJ1tvdy1jb25maWctaWQ9Jytjb25maWdJZCsnXSBbb3cta2V5PScgKyBmaWx0ZXIuS2V5ICsgJ10nKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckVsZW0gPT0gdW5kZWZpbmVkIHx8IGZpbHRlckVsZW0ubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckVsZW0gPSAkKCdbb3ctY29uZmlnLWlkPScrY29uZmlnSWQrJ10gW293LXNlY29uZGFyeS1rZXk9JyArIGZpbHRlci5LZXkgKyAnXScpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJFbGVtICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLlZhbHVlcy5mb3JFYWNoKGZpbHRlclZhbHVlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsdGVyVmFsdWVFbGVtID0gZmlsdGVyRWxlbS5wYXJlbnQoKS5maW5kKCdbaWQ9IicgKyBmaWx0ZXJWYWx1ZSArICciXScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJWYWx1ZUVsZW0gIT0gdW5kZWZpbmVkICYmIGZpbHRlclZhbHVlRWxlbS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclZhbHVlRWxlbS5wcm9wKCdjaGVja2VkJywgJ2NoZWNrZWQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZUVsZW0gPSBmaWx0ZXJFbGVtLnBhcmVudCgpLmZpbmQoJ1t2YWx1ZT0iJyArIGZpbHRlclZhbHVlICsgJyJdJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJWYWx1ZUVsZW0gIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZUVsZW0ucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZUVsZW0ucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVFbGVtLmF0dHIoJ3RhYkluZGV4JywgJzAnKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciByclVwZGF0ZVN0YXRpc3RpY3MgPSBmdW5jdGlvbiAoc2VhcmNoT2JqKSB7DQogICAgICAgICAgICAgICAgaWYgKHNlYXJjaE9iai5QYXJhbWV0ZXJzLlNlYXJjaFRlcm0gIT0gdW5kZWZpbmVkICYmIHNlYXJjaE9iai5QYXJhbWV0ZXJzLlNlYXJjaFRlcm0ubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBzZWFyY2hPYmouU2VhcmNoQm94LmZpbmQoJy5maWx0ZXItZmFjZXRzIC5zZWFyY2gtdmFsdWUnKS5yZW1vdmVDbGFzcygnZC1ub25lJyk7DQogICAgICAgICAgICAgICAgICAgIHNlYXJjaE9iai5TZWFyY2hCb3guZmluZCgnLmZpbHRlci1mYWNldHMgLnJlc3VsdC10ZXh0JykucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHNlYXJjaE9iai5TZWFyY2hCb3guZmluZCgnLmZpbHRlci1mYWNldHMgLnNlYXJjaC12YWx1ZScpLmFkZENsYXNzKCdkLW5vbmUnKTsNCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoT2JqLlNlYXJjaEJveC5maW5kKCcuZmlsdGVyLWZhY2V0cyAucmVzdWx0LXRleHQnKS5hZGRDbGFzcygnZC1ub25lJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHZhciBzZWFyY2hWYWx1ZSA9IHNlYXJjaE9iai5TZWFyY2hCb3guZmluZCgnc3Bhbi5zZWFyY2gtdmFsdWUnKTsNCiAgICAgICAgICAgICAgICBpZiAoc2VhcmNoT2JqLktleXdvcmQgIT0gdW5kZWZpbmVkICYmIHNlYXJjaE9iai5LZXl3b3JkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCQoc2VhcmNoVmFsdWUpLmhhc0NsYXNzKCd3cmFwLWRvdWJsZS1xdW90ZXMnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoVmFsdWUudGV4dCgiXCIiICsgc2VhcmNoT2JqLktleXdvcmQgKyAiXCIiKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFZhbHVlLnRleHQoc2VhcmNoT2JqLktleXdvcmQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgc2VhcmNoT2JqLlNlYXJjaEJveC5maW5kKCdzcGFuLnNlYXJjaC1jdXJyZW50LWNvdW50JykudGV4dChzZWFyY2hPYmouUGFyYW1ldGVycy5JdGVyYXRlZFJlc3VsdENvdW50KTsNCiAgICAgICAgICAgICAgICBzZWFyY2hPYmouU2VhcmNoQm94LmZpbmQoJ3NwYW4uc2VhcmNoLXRvdGFsLWNvdW50JykudGV4dChzZWFyY2hPYmouUGFyYW1ldGVycy5Ub3RhbFJlc3VsdENvdW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciByclVwZGF0ZVZpc2liaWxpdHkgPSBmdW5jdGlvbiAoc2VhcmNoT2JqKSB7DQogICAgICAgICAgICAgICAgaWYgKHNlYXJjaE9iai5QYXJhbWV0ZXJzLlJlbWFpbmluZ1BhZ2VDb3VudCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICQoc2VhcmNoT2JqLkxvYWRNb3JlKS5hZGRDbGFzcygnZC1ub25lJyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJChzZWFyY2hPYmouTG9hZE1vcmUpLnJlbW92ZUNsYXNzKCdkLW5vbmUnKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoJCgnLm93LXNlYXJjaC1ib3ggLmZpbHRlci1zZWFyY2gtd3JhcHBlciAuc2VhcmNoLWJveC1pbnB1dCcpLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2VhcmNoT2JqICE9IHVuZGVmaW5lZCAmJiBzZWFyY2hPYmouUGFyYW1ldGVycyAhPSB1bmRlZmluZWQgJiYgc2VhcmNoT2JqLlBhcmFtZXRlcnMuQ3VycmVudFJlc3VsdENvdW50ID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJCgnW293LWNvbmZpZy1pZD0nICsgc2VhcmNoT2JqLkNvbmZpZ3VyYXRpb25JZCArICddW2lzLXJlc3VsdF0nKS5yZW1vdmVDbGFzcygnZC1ub25lJyk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkKCdbb3ctY29uZmlnLWlkPScgKyBzZWFyY2hPYmouQ29uZmlndXJhdGlvbklkICsgJ11baXMtcmVzdWx0XScpLmFkZENsYXNzKCdkLW5vbmUnKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChzZWFyY2hPYmouS2V5d29yZCAhPSB1bmRlZmluZWQgJiYgc2VhcmNoT2JqLktleXdvcmQubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAkKCcucmVzdWx0LXRleHQnKS5ub3QoJy5uby1rZXl3b3JkJykucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpOw0KICAgICAgICAgICAgICAgICAgICAkKCcucmVzdWx0LXRleHQubm8ta2V5d29yZCcpLmFkZENsYXNzKCdkLW5vbmUnKQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICQoJy5yZXN1bHQtdGV4dCcpLm5vdCgnLm5vLWtleXdvcmQnKS5hZGRDbGFzcygnZC1ub25lJyk7DQogICAgICAgICAgICAgICAgICAgICQoJy5yZXN1bHQtdGV4dC5uby1rZXl3b3JkJykucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHJyU2V0UG9zdFNlYXJjaEZpbHRlcnMgPSBmdW5jdGlvbiAoc2VhcmNoT2JqKSB7DQogICAgICAgICAgICAgICAgdmFyIGVuYWJsZWRGaWx0ZXJzID0gJChzZWFyY2hPYmouV3JhcHBlcikuYXR0cignb3ctZmlsdGVycycpDQogICAgICAgICAgICAgICAgaWYgKGVuYWJsZWRGaWx0ZXJzICE9IHVuZGVmaW5lZCAmJiBlbmFibGVkRmlsdGVycy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIGVuYWJsZWRGaWx0ZXJzID0gSlNPTi5wYXJzZShlbmFibGVkRmlsdGVycyk7DQogICAgICAgICAgICAgICAgICAgIGlmIChlbmFibGVkRmlsdGVycyAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWRGaWx0ZXJzLmZvckVhY2goZmlsdGVyR3JvdXAgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJHcm91cC5LZXkgIT0gJ3RhZ3Nfc20nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RmlsdGVyID0gJCgnW293LWNvbmZpZy1pZD0nICsgc2VhcmNoT2JqLkNvbmZpZ3VyYXRpb25JZCArICddW2lzLWZpbHRlcl0nKS5maW5kKCcuZmlsdGVyLWZhY2V0LXdyYXBwZXIgLmZpbHRlci1mYWNldC1oZWFkW293LWtleT0nICsgZmlsdGVyR3JvdXAuS2V5ICsgJ10nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5tYXAoZmlsdGVyR3JvdXAuVmFsdWVzLCBmdW5jdGlvbiAoZmlsdGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRGaWx0ZXIpLnBhcmVudHMoJy5maWx0ZXItZmFjZXQtd3JhcHBlcicpLmZpbmQoJ1tpZD0iJyArIGZpbHRlciArICciXScpLnByb3AoJ2NoZWNrZWQnLCB0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9hZHZhbmNlZCBmaWx0ZXJzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhZHZhbmNlZEZpbHRlciA9ICQoJ1tvdy1jb25maWctaWQ9JyArIHNlYXJjaE9iai5Db25maWd1cmF0aW9uSWQgKyAnXVtpcy1hZHZhbmNlZC1maWx0ZXJdJykuZmluZCgnLmZpbHRlci1mYWNldC13cmFwcGVyIC5maWx0ZXItZmFjZXQtaGVhZFtvdy1zZWNvbmRhcnkta2V5PScgKyBmaWx0ZXJHcm91cC5LZXkgKyAnXScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLm1hcChmaWx0ZXJHcm91cC5WYWx1ZXMsIGZ1bmN0aW9uIChmaWx0ZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWNvbmRhcnlGaWx0ZXIgPSAkKGFkdmFuY2VkRmlsdGVyKS5wYXJlbnRzKCcuZmlsdGVyLWZhY2V0LXdyYXBwZXInKS5maW5kKCdbaWQ9IicgKyBmaWx0ZXIgKyAnIl0nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZGFyeUZpbHRlci5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJpbWFyeUZpbHRlciA9IHNlY29uZGFyeUZpbHRlci5wYXJlbnRzKCcuZmlsdGVyLWl0ZW0nKS5maW5kKCdpbnB1dCcpLmVxKDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUZpbHRlci5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdmFyIHNlY29uZGFyeUZpbHRlcnMgPSAkKCcuZmlsdGVyLWZhY2V0LWl0ZW1zLXNlY29uZGFyeScpOw0KDQogICAgICAgICAgICAgICAgaWYgKHNlY29uZGFyeUZpbHRlcnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBzZWNvbmRhcnlGaWx0ZXJzLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByaW1hcnlGaWx0ZXIgPSAkKHRoaXMpLnBhcmVudHMoJy5maWx0ZXItaXRlbScpLmZpbmQoJ2lucHV0JykuZXEoMCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJpbWFyeUZpbHRlci5wcm9wKCdjaGVja2VkJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdkLW5vbmUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnZC1ub25lJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICByckFwcGVuZFVybFBhcmFtZXRlcnMoaW5wdXRPYmopOw0KICAgICAgICAgICAgcnJSZW5kZXJGaWx0ZXJzKGlucHV0T2JqLkRhdGEpOw0KICAgICAgICAgICAgcnJVcGRhdGVTdGF0aXN0aWNzKHNlYXJjaENvbnRleHQpOw0KICAgICAgICAgICAgcnJVcGRhdGVWaXNpYmlsaXR5KHNlYXJjaENvbnRleHQpOw0KICAgICAgICAgICAgcnJTZXRQb3N0U2VhcmNoRmlsdGVycyhzZWFyY2hDb250ZXh0KTsNCiAgICAgICAgICAgIGlmIChsb2FkbW9yZSA9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIGlmICgkKCcub3ctc2VhcmNoLWJveCAuZmlsdGVyLXNlYXJjaC13cmFwcGVyIC5zZWFyY2gtYm94LWlucHV0JykubGVuZ3RoICYmICQoJy5vdy1zZWFyY2gtYm94IC5maWx0ZXItc2VhcmNoLXdyYXBwZXIgLnNlYXJjaC1ib3gtaW5wdXQnKS52YWwoKSAhPSAnJykgew0KICAgICAgICAgICAgICAgICAgICAkKFtkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGRvY3VtZW50LmJvZHldKS5hbmltYXRlKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogJCgnLm93LXNlYXJjaC1ib3hbb3ctY29uZmlnLWlkPSInICsgc2VhcmNoQ29udGV4dC5Db25maWd1cmF0aW9uSWQgKyAnIl0nKS5vZmZzZXQoKS50b3AgLSAkKCcjaGVhZGVyJykuaGVpZ2h0KCkgLSA1MA0KICAgICAgICAgICAgICAgICAgICB9LCA1MDApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsb2FkbW9yZSA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBvd0xhenlMb2FkLmJpbmRMYXp5TG9hZFRyaWdnZXJzKCk7DQogICAgICAgICAgICBvd1BhZ2luYXRpb24uaW5pdCgpOw0KICAgICAgICAgICAgZmlsdGVyaW50KCk7DQogICAgICAgICAgICBzbGlkZXIuaW5pdCgpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHZhciBzdGFydFNlYXJjaCA9IGZ1bmN0aW9uIChzT2JqZWN0LCBpc0F1dG9TdWdnZXN0ID0gZmFsc2UpIHsNCiAgICAgICAgaWYgKHNPYmplY3QgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBpZiAoaXNBdXRvU3VnZ2VzdCkgew0KICAgICAgICAgICAgICAgIHNzQXV0b1N1Z2dlc3RTZWFyY2goc09iamVjdCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlzTm9ybWFsU2VhcmNoKHNPYmplY3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gaXNOb3JtYWxTZWFyY2goc2VhcmNoT2JqZWN0KSB7DQogICAgICAgICAgICBpZiAoc2VhcmNoT2JqZWN0ICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIHZhciBoYk9iamVjdCA9IGdldENvbnRleHQoc2VhcmNoT2JqZWN0LldyYXBwZXIsIHNlYXJjaE9iamVjdC5QYWdlVHlwZSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIGhiT2JqZWN0LkZpbHRlcnMgPSBzc0ZldGNoRmlsdGVycyhoYk9iamVjdC5Db25maWd1cmF0aW9uSWQpLA0KICAgICAgICAgICAgICAgICAgICBzc1NhdmVQcmVTZWFyY2hGaWx0ZXJzKHNlYXJjaE9iamVjdC5XcmFwcGVyLCBoYk9iamVjdCk7DQogICAgICAgICAgICAgICAgb3dIYW5kbGViYXIuZmV0Y2goaGJPYmplY3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIHNzQXV0b1N1Z2dlc3RTZWFyY2goc2VhcmNoT2JqZWN0KSB7DQogICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsDQogICAgICAgICAgICAgICAgdXJsOiBzZWFyY2hPYmplY3QuRW5kcG9pbnQsDQogICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoeyAncGFyYW1ldGVycyc6IHNlYXJjaE9iamVjdCB9KSwNCiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsDQogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywNCiAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsDQogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuR3JvdXBzICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5Hcm91cHMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuR3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXAuUmVzdWx0cyAhPSB1bmRlZmluZWQgJiYgZ3JvdXAuUmVzdWx0cy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnREaXYgPSAkKHNlYXJjaE9iamVjdC5Db250YWluZXIpLnBhcmVudHMoJ1tvdy1jb25maWctaWRdJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdXRvU3VnZ2VzdFRlbXBsYXRlID0gcGFyZW50RGl2LmZpbmQoJy5vdy10ZW1wbGF0ZScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0b1N1Z2dlc3RUZW1wbGF0ZSAhPSB1bmRlZmluZWQgJiYgYXV0b1N1Z2dlc3RUZW1wbGF0ZS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGJUZW1wbGF0ZSA9IEhhbmRsZWJhcnMuY29tcGlsZShhdXRvU3VnZ2VzdFRlbXBsYXRlLmh0bWwoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gaGJUZW1wbGF0ZShyZXNwb25zZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXV0b1N1Z2dlc3RDb250YWluZXIgPSBwYXJlbnREaXYuZmluZCgnLm93LWNvbnRhaW5lcicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dG9TdWdnZXN0Q29udGFpbmVyICE9IHVuZGVmaW5lZCAmJiBhdXRvU3VnZ2VzdENvbnRhaW5lci5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1N1Z2dlc3RDb250YWluZXIuaHRtbChjb250ZW50KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoeGhyKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHhocik7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIHNzU2F2ZVByZVNlYXJjaEZpbHRlcnMod3JhcHBlciwgc2VhcmNoT2JqKSB7DQogICAgICAgICAgICAkKHdyYXBwZXIpLmF0dHIoJ293LWZpbHRlcnMnLCBKU09OLnN0cmluZ2lmeShzZWFyY2hPYmouRmlsdGVycykpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gc3NGZXRjaEZpbHRlcnMoY29uZmlndXJhdGlvbklkKSB7DQogICAgICAgICAgICB2YXIgYWN0aXZlRmlsdGVycyA9IFtdDQogICAgICAgICAgICAkKCdbb3ctY29uZmlnLWlkPScgKyBjb25maWd1cmF0aW9uSWQgKyAnXVtpcy1maWx0ZXJdJykuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIGZpbHRlckdyb3VwID0gJCh0aGlzKS5maW5kKCcuZmlsdGVyLWZhY2V0LXdyYXBwZXInKS5ub3QoIi5vdy10ZW1wbGF0ZSAuZmlsdGVyLWZhY2V0LXdyYXBwZXIiKS5wYXJlbnRzKCcub3ctc2VhcmNoLXRlbXBsYXRlJykubm90KCdbaXMtYWR2YW5jZWQtZmlsdGVyXScpOw0KICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJHcm91cCAhPSB1bmRlZmluZWQgJiYgZmlsdGVyR3JvdXAubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgZmlsdGVyT2JqZWN0ID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgS2V5OiBmaWx0ZXJHcm91cC5maW5kKCcuZmlsdGVyLWZhY2V0LWhlYWQnKS5hdHRyKCdvdy1rZXknKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlczogW10NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cignaXMtYWxwaGFiZXQtZmlsdGVyJykgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlRmlsdGVyID0gJCh0aGlzKS5maW5kKCcuaXNBY3RpdmUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmVGaWx0ZXIubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlck9iamVjdC5WYWx1ZXMucHVzaChhY3RpdmVGaWx0ZXIuYXR0cigndmFsdWUnKS50b0xvd2VyQ2FzZSgpICsgIioiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLmF0dHIoJ2lzLWxpbmstZmlsdGVyJykgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlRmlsdGVyID0gJCh0aGlzKS5maW5kKCcuaXNBY3RpdmUnKS5ub3QoJy5kaXNhYmxlZCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUZpbHRlci5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyT2JqZWN0LlZhbHVlcy5wdXNoKGFjdGl2ZUZpbHRlci5hdHRyKCdpZCcpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJHcm91cC5maW5kKCcuc2hvdy1maWx0ZXInKS5ub3QoJy51bmNoZWNrLWFsbCcpLmFkZENsYXNzKCdkLW5vbmUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyR3JvdXAuZmluZCgnLnNob3ctZmlsdGVyJykubm90KCcudW5jaGVjay1hbGwnKS5yZW1vdmVDbGFzcygnZC1ub25lJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyR3JvdXAuZmluZCgnLmZpbHRlcnMtY2FyZF9faXRlbXMnKS5yZW1vdmVDbGFzcygnZXhwYW5kLWZpbHRlcicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJC5tYXAoZmlsdGVyR3JvdXAuZmluZCgnaW5wdXQ6Y2hlY2tlZCcpLCBmdW5jdGlvbiAoZmlsdGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyT2JqZWN0LlZhbHVlcy5wdXNoKCQoZmlsdGVyKS5hdHRyKCdpZCcpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAkLm1hcChmaWx0ZXJHcm91cC5maW5kKCdhLmlzQWN0aXZlJykubm90KCcuZGlzYWJsZWQnKSwgZnVuY3Rpb24gKGZpbHRlcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKGZpbHRlcikuYXR0cigndmFsdWUnKSAhPSB1bmRlZmluZWQgJiYgJChmaWx0ZXIpLmF0dHIoJ3ZhbHVlJykubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJPYmplY3QuVmFsdWVzLnB1c2goJChmaWx0ZXIpLmF0dHIoJ3ZhbHVlJykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGZpbHRlcikucmVtb3ZlQ2xhc3MoJ2lzQWN0aXZlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyT2JqZWN0LlZhbHVlcy5wdXNoKCQoZmlsdGVyKS5hdHRyKCdpZCcpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChmaWx0ZXIpLnJlbW92ZUNsYXNzKCdpc0FjdGl2ZScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlck9iamVjdC5WYWx1ZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRmlsdGVycy5wdXNoKGZpbHRlck9iamVjdCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyR3JvdXAgPSAkKHRoaXMpLmZpbmQoJy5maWx0ZXItZmFjZXQtd3JhcHBlcicpLm5vdCgiLm93LXRlbXBsYXRlIC5maWx0ZXItZmFjZXQtd3JhcHBlciIpLnBhcmVudHMoJy5vdy1zZWFyY2gtdGVtcGxhdGVbaXMtYWR2YW5jZWQtZmlsdGVyXScpDQogICAgICAgICAgICAgICAgaWYgKGZpbHRlckdyb3VwICE9IHVuZGVmaW5lZCAmJiBmaWx0ZXJHcm91cC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBwcmltYXJ5RmlsdGVyT2JqZWN0ID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgS2V5OiBmaWx0ZXJHcm91cC5maW5kKCcuZmlsdGVyLWZhY2V0LWhlYWQnKS5hdHRyKCdvdy1rZXknKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlczogW10NCiAgICAgICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgICAgICAkLm1hcChmaWx0ZXJHcm91cC5maW5kKCdpbnB1dDpjaGVja2VkJykubm90KCcuc3ViLWl0ZW0nKSwgZnVuY3Rpb24gKGZpbHRlcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUZpbHRlck9iamVjdC5WYWx1ZXMucHVzaCgkKGZpbHRlcikuYXR0cignaWQnKSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgIGlmIChwcmltYXJ5RmlsdGVyT2JqZWN0LlZhbHVlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVGaWx0ZXJzLnB1c2gocHJpbWFyeUZpbHRlck9iamVjdCk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICB2YXIgc2Vjb25kYXJ5RmlsdGVyT2JqZWN0ID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgS2V5OiBmaWx0ZXJHcm91cC5maW5kKCcuZmlsdGVyLWZhY2V0LWhlYWQnKS5hdHRyKCdvdy1zZWNvbmRhcnkta2V5JyksDQogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZXM6IFtdDQogICAgICAgICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgICAgICAgJC5tYXAoZmlsdGVyR3JvdXAuZmluZCgnaW5wdXQuc3ViLWl0ZW06Y2hlY2tlZCcpLCBmdW5jdGlvbiAoZmlsdGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRhcnlGaWx0ZXJPYmplY3QuVmFsdWVzLnB1c2goJChmaWx0ZXIpLmF0dHIoJ2lkJykpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kYXJ5RmlsdGVyT2JqZWN0LlZhbHVlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVGaWx0ZXJzLnB1c2goc2Vjb25kYXJ5RmlsdGVyT2JqZWN0KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICB2YXIgYWN0aXZlVGFnRWxlbXMgPSAkKCcuZmlsdGVyLXNlYXJjaC13cmFwcGVyJykuZmluZCgnLnN1Z2dlc3Rpb24tbGFiZWwnKTsNCiAgICAgICAgICAgIGlmIChhY3RpdmVUYWdFbGVtcyAhPSB1bmRlZmluZWQgJiYgYWN0aXZlVGFnRWxlbXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIHZhciB0YWdPYmplY3QgPSB7DQogICAgICAgICAgICAgICAgICAgIEtleTogJ293X3RhZ2xpc3Rfc20nLA0KICAgICAgICAgICAgICAgICAgICBWYWx1ZXM6IFtdDQogICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgICQubWFwKGFjdGl2ZVRhZ0VsZW1zLCBmdW5jdGlvbiAodGFnRWxlbSkgew0KICAgICAgICAgICAgICAgICAgICB0YWdPYmplY3QuVmFsdWVzLnB1c2goJCh0YWdFbGVtKS5hdHRyKCd0YWctaWQnKSk7DQogICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICBpZiAodGFnT2JqZWN0LlZhbHVlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIGFjdGl2ZUZpbHRlcnMucHVzaCh0YWdPYmplY3QpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFjdGl2ZUZpbHRlcnM7DQogICAgICAgIH0NCg0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldFJlc3VsdFdyYXBwZXIoZWxlbSkgew0KICAgICAgICBpZiAoZWxlbSAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHZhciBwYXJlbnREaXYgPSAkKGVsZW0pLmNsb3Nlc3QoJ1tvdy1jb25maWctaWRdJyk7DQogICAgICAgICAgICBpZiAocGFyZW50RGl2ID09IHVuZGVmaW5lZCB8fCBwYXJlbnREaXYubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICBwYXJlbnREaXYgPSAkKGVsZW0pLnBhcmVudHMoJ1tvdy1jb25maWctaWRdJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocGFyZW50RGl2ICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIHZhciBjb25maWd1cmF0aW9uSWQgPSBwYXJlbnREaXYuYXR0cignb3ctY29uZmlnLWlkJyk7DQogICAgICAgICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25JZCAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQoJ1tvdy1jb25maWctaWQ9JyArIGNvbmZpZ3VyYXRpb25JZCArICddW2lzLXJlc3VsdF0nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgdmFyIGdldEF1dG9TdWdnZXN0Q29udGV4dCA9IGZ1bmN0aW9uIChlbGVtLCBpc1ZpZXdBbGwpIHsNCiAgICAgICAgaWYgKGlzVmlld0FsbCkgew0KICAgICAgICAgICAgdmFyIGFzR3JvdXBDb250YWluZXIgPSAkKGVsZW0pLnBhcmVudHMoJ1tvdy1hcy1ncm91cC1pZGVudGlmaWVyXScpOw0KICAgICAgICAgICAgdmFyIHNlYXJjaEJveCA9ICQoZWxlbSkucGFyZW50cygnLm93LXNlYXJjaC1ib3gnKTsNCiAgICAgICAgICAgIGlmIChhc0dyb3VwQ29udGFpbmVyICE9IHVuZGVmaW5lZCAmJiBhc0dyb3VwQ29udGFpbmVyLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICB2YXIgZ3JvdXBJZCA9IGFzR3JvdXBDb250YWluZXIuYXR0cignb3ctYXMtZ3JvdXAtaWRlbnRpZmllcicpOw0KICAgICAgICAgICAgICAgIHZhciBpZCA9IGFzR3JvdXBDb250YWluZXIuYXR0cignb3ctYXMtaWRlbnRpZmllcicpOw0KICAgICAgICAgICAgICAgIHZhciBzZWFyY2hQYWdlVXJsID0gc2VhcmNoQm94LmF0dHIoJ293LWFzLXJlc3VsdC1wYWdlJyk7DQogICAgICAgICAgICAgICAgdmFyIGtleXdvcmQgPSBzZWFyY2hCb3guZmluZCgnaW5wdXQnKS52YWwoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dCA9IHsNCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoUGFnZTogc2VhcmNoUGFnZVVybCwNCiAgICAgICAgICAgICAgICAgICAgS2V5d29yZDoga2V5d29yZCwNCiAgICAgICAgICAgICAgICAgICAgSWQ6IGlkLA0KICAgICAgICAgICAgICAgICAgICBHcm91cElkOiBncm91cElkLA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHZhciBwYXJlbnRFbGVtID0gZWxlbS5wYXJlbnRzKCcub3ctc2VhcmNoLWJveCcpOw0KICAgICAgICAgICAgdmFyIHNlYXJjaFBhZ2VVcmwgPSBwYXJlbnRFbGVtLmF0dHIoJ293LWFzLXJlc3VsdC1wYWdlJyk7DQogICAgICAgICAgICB2YXIga2V5d29yZCA9IHBhcmVudEVsZW0uZmluZCgnaW5wdXQnKS52YWwoKTsNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0ID0gew0KICAgICAgICAgICAgICAgIFNlYXJjaFBhZ2U6IHNlYXJjaFBhZ2VVcmwsDQogICAgICAgICAgICAgICAgS2V5d29yZDoga2V5d29yZCwNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICB2YXIgZ2V0Q29udGV4dCA9IGZ1bmN0aW9uIChlbGVtLCBwYWdpbmF0aW9uVHlwZSwgaW5jbHVkZVdyYXBwZXIgPSBmYWxzZSkgew0KICAgICAgICB2YXIgcmVzdWx0V3JhcHBlciA9IGdldFJlc3VsdFdyYXBwZXIoZWxlbSk7DQogICAgICAgIHZhciBjb25maWd1cmF0aW9uSWQgPSByZXN1bHRXcmFwcGVyLmF0dHIoJ293LWNvbmZpZy1pZCcpOw0KICAgICAgICB2YXIgc2VhcmNoQm94ID0gJCgnLm93LXNlYXJjaC1ib3hbb3ctY29uZmlnLWlkPScgKyBjb25maWd1cmF0aW9uSWQgKyAnXScpOw0KICAgICAgICB2YXIgc2VhcmNoSW5wdXQgPSBzZWFyY2hCb3guZmluZCgnaW5wdXQnKS52YWwoKTsNCiAgICAgICAgaWYgKHBhZ2luYXRpb25UeXBlID09IFBhZ2luYXRpb25UeXBlLlBhZ2luYXRpb24pIHsNCiAgICAgICAgICAgIHBhcmFtZXRlckpzb24gPSByZXN1bHRXcmFwcGVyLmF0dHIoJ293LXBhcmFtZXRlcnMnKTsNCiAgICAgICAgICAgIHNlYXJjaElucHV0ID0gSlNPTi5wYXJzZShwYXJhbWV0ZXJKc29uKS5TZWFyY2hUZXJtOw0KICAgICAgICB9DQogICAgICAgIHZhciBjb250ZXh0T2JqZWN0ID0gew0KICAgICAgICAgICAgRW5kcG9pbnQ6IHJlc3VsdFdyYXBwZXIuYXR0cignb3ctZW5kcG9pbnQnKSwNCiAgICAgICAgICAgIFNvdXJjZUlkOiByZXN1bHRXcmFwcGVyLmF0dHIoJ293LXNvdXJjZS1pZCcpLA0KICAgICAgICAgICAgQ29uZmlndXJhdGlvbklkOiBjb25maWd1cmF0aW9uSWQsDQogICAgICAgICAgICBLZXl3b3JkOiBzZWFyY2hJbnB1dCwNCiAgICAgICAgICAgIFBhZ2VTaXplOiByZXN1bHRXcmFwcGVyLmF0dHIoJ293LXBhZ2Utc2l6ZScpLA0KICAgICAgICAgICAgUGFnZXNUb1NraXA6IDAsDQogICAgICAgICAgICBQYWdlVHlwZTogcGFnaW5hdGlvblR5cGUsDQogICAgICAgICAgICBBcHBlbmQ6IHBhZ2luYXRpb25UeXBlID09PSBQYWdpbmF0aW9uVHlwZS5MYXp5TG9hZCwNCiAgICAgICAgICAgIExhbmd1YWdlOiBzZWFyY2hCb3guYXR0cignb3ctbGFuZ3VhZ2UnKSwNCiAgICAgICAgfTsNCiAgICAgICAgaWYgKCQocmVzdWx0V3JhcHBlcikuYXR0cignb3ctcGFyYW1ldGVycycpICE9IHVuZGVmaW5lZCAmJiBwYWdpbmF0aW9uVHlwZSAhPSBQYWdpbmF0aW9uVHlwZS5Ob25lKSB7DQogICAgICAgICAgICB2YXIgcGFyYW1ldGVycyA9IEpTT04ucGFyc2UoJChyZXN1bHRXcmFwcGVyKS5hdHRyKCdvdy1wYXJhbWV0ZXJzJykpOw0KICAgICAgICAgICAgY29udGV4dE9iamVjdC5QYWdlc1RvU2tpcCA9IHBhcmFtZXRlcnMuSXRlcmF0ZWRQYWdlQ291bnQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhZ2luYXRpb25UeXBlID09IFBhZ2luYXRpb25UeXBlLk5vbmUpIHsNCiAgICAgICAgICAgIGNvbnRleHRPYmplY3QuUGFnZXNUb1NraXAgPSAwOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGluY2x1ZGVXcmFwcGVyKSB7DQogICAgICAgICAgICB2YXIgcmVzdWx0Q29udGFpbmVyID0gcmVzdWx0V3JhcHBlci5maW5kKCcub3ctY29udGFpbmVyJyk7DQogICAgICAgICAgICB2YXIgcmVzdWx0VGVtcGxhdGUgPSByZXN1bHRXcmFwcGVyLmZpbmQoJy5vdy10ZW1wbGF0ZScpOw0KICAgICAgICAgICAgdmFyIGxvYWRNb3JlQnV0dG9uID0gcmVzdWx0V3JhcHBlci5maW5kKCcub3ctbG9hZC1tb3JlJyk7DQogICAgICAgICAgICBpZiAocmVzdWx0V3JhcHBlci5hdHRyKCdvdy1wYXJhbWV0ZXJzJykgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgY29udGV4dE9iamVjdC5QYXJhbWV0ZXJzID0gSlNPTi5wYXJzZSgkKHJlc3VsdFdyYXBwZXIpLmF0dHIoJ293LXBhcmFtZXRlcnMnKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb250ZXh0T2JqZWN0LldyYXBwZXIgPSByZXN1bHRXcmFwcGVyOw0KICAgICAgICAgICAgY29udGV4dE9iamVjdC5Db250YWluZXIgPSByZXN1bHRDb250YWluZXI7DQogICAgICAgICAgICBjb250ZXh0T2JqZWN0LlRlbXBsYXRlID0gcmVzdWx0VGVtcGxhdGU7DQogICAgICAgICAgICBjb250ZXh0T2JqZWN0LkxvYWRNb3JlID0gbG9hZE1vcmVCdXR0b247DQogICAgICAgICAgICBjb250ZXh0T2JqZWN0LlNlYXJjaEJveCA9IHNlYXJjaEJveDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VhcmNoQm94LmZpbmQoJ2lucHV0JykubGVuZ3RoID4gMCAmJiBzZWFyY2hCb3guZmluZCgnaW5wdXQnKS52YWwoKSAhPSAnJykgew0KICAgICAgICAgICAgJCgnLm93LXNlYXJjaC1ib3hbb3ctY29uZmlnLWlkPScgKyBjb25maWd1cmF0aW9uSWQgKyAnXSAuY2xlYXItdGV4dCcpLmFkZENsYXNzKCdkLWJsb2NrJyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gY29udGV4dE9iamVjdDsNCiAgICB9DQoNCiAgICByZXR1cm4gew0KICAgICAgICByZW5kZXJSZXN1bHRzOiByZW5kZXJSZXN1bHRzLA0KICAgICAgICBzdGFydFNlYXJjaDogc3RhcnRTZWFyY2gsDQogICAgICAgIGJpbmRPbmVUaW1lVHJpZ2dlcnM6IGJpbmRPbmVUaW1lVHJpZ2dlcnMsDQogICAgICAgIHRyaWdnZXJQYWdpbmF0aW9uOiB0cmlnZ2VyUGFnaW5hdGlvbg0KICAgIH07DQp9KSgpOw0KDQokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7DQogICAgb3dTZWFyY2guYmluZE9uZVRpbWVUcmlnZ2VycygpOw0KfSkNCg0KDQpmdW5jdGlvbiBmaWx0ZXJpbnQoKSB7DQogICAgaWYgKCQoJy5maWx0ZXJzLWNhcmQnKS5sZW5ndGggPiAwKSB7DQogICAgICAgICQoJy5maWx0ZXJzLWNhcmQnKS5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciB3cmFwSXRlbXMgPSBwYXJzZUludCgkKHRoaXMpLmF0dHIoJ2RhdGEtbGlzdCcpKTsNCiAgICAgICAgICAgIHZhciBsaXN0SXRlbXMgPSAkKHRoaXMpLmZpbmQoJ3VsIGxpJyk7DQogICAgICAgICAgICBpZiAobGlzdEl0ZW1zLmxlbmd0aCA+IHdyYXBJdGVtcykgew0KICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgndWwgPiBsaTpsdCgnICsgKHdyYXBJdGVtcykgKyAnKScpLndyYXBBbGwoJzxkaXYgY2xhc3M9Imxpc3QtZGVmYXVsdCI+PC9kaXY+Jyk7DQogICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuZmlsdGVycy1jYXJkX19pdGVtcyB1bCA+IGxpJykud3JhcEFsbCgnPGRpdiBjbGFzcz0ibGlzdC1leHBhbmFibGUiPjwvZGl2PicpDQogICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuc2hvdy1maWx0ZXInKS5zaG93KCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgnLnNob3ctZmlsdGVyJykuaGlkZSgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0pDQogICAgfQ0KDQp9
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 40440
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: de
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20221013T215959Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20221013T215959Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
- Language: fr
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20221013T215959Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
